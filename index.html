<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Call Logs Tool</title>

  <!-- Firebase CDN (COMPAT – required for GitHub Pages) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    :root { --bg:#f4f6f9; --card:#fff; --primary:#5b2be0; --text:#222; }
    body { margin:0; font-family:Arial,sans-serif; background:var(--bg); color:var(--text); }
    header { display:none; align-items:center; justify-content:space-between; background:#fff; padding:10px 20px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    .container { max-width:1100px; margin:auto; padding:20px; }
    .card { background:var(--card); padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.08); margin-bottom:20px; }
    input,select,textarea { width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc; }
    button { cursor:pointer; }
    .primary { background:var(--primary); color:#fff; border:none; padding:10px 16px; border-radius:8px; }
    .logout { background:#666; color:#fff; border:none; padding:6px 12px; border-radius:6px; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:10px; border-bottom:1px solid #ddd; font-size:13px; }
    .hidden { display:none; }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="container">
  <div class="card" style="max-width:420px;margin:auto;text-align:center;">
    <img src="./images/SL-Logo.png" height="100" />
    <h2>Login</h2>
    <input id="loginEmail" type="email" placeholder="name@supplylogic.com" />
    <input id="loginPassword" type="password" placeholder="Password" />
    <button class="primary" onclick="login()">Login</button>
  </div>
</div>

<!-- HEADER -->
<header id="appHeader">
  <img src="./images/SL-Logo4.png" height="95" />
  <div>
    <span id="userEmail"></span>
    <button class="logout" onclick="logout()">Logout</button>
  </div>
</header>

<!-- APP -->
<div id="app" class="container hidden">

  <div class="card">
    <h3>New Call Log</h3>
    <input id="customer" placeholder="Customer Name" />
    <input id="phone" placeholder="Phone Number" />
    <input id="refId" placeholder="User ID / Order # / INV #" />

    <select id="tool" onchange="loadCompanies()">
      <option value="">Select Tool</option>
      <option>Shopify</option>
      <option>Marcom</option>
      <option>Marketing Bench</option>
    </select>

    <select id="company"></select>

    <select id="disposition">
      <option>Password Reset</option>
      <option>Order Entry</option>
      <option>Order Status/ Tracking</option>
      <option>Impersonate</option>
    </select>

    <select id="status">
      <option>Open</option>
      <option>Follow-up</option>
      <option>Resolved</option>
    </select>

    <textarea id="notes" rows="6">Concern:\n\n\nAction Taken:</textarea>
    <button class="primary" onclick="saveLog()">Submit Log</button>
  </div>

  <div class="card">
    <h3>History</h3>
    <table>
      <thead><tr><th>Customer</th><th>Phone</th><th>Company</th><th>Disposition</th><th>Status</th><th>Agent</th><th>Date</th><th>Notes</th></tr></thead>
      <tbody id="logTable"></tbody>
    </table>
  </div>

  <div id="adminPanel" class="card hidden">
    <h3>Admin</h3>
    <button class="primary" onclick="exportCSV()">Export CSV</button>
  </div>
</div>

<script>
/* FIREBASE CONFIG – PASTE REAL VALUES HERE */
firebase.initializeApp({
  apiKey: "AIzaSyBEbq_d9nGXFLNdHaWICDfOzvQECC6yjOQ",
  authDomain: "call-logs-tool.firebaseapp.com",
  projectId: "call-logs-tool"
});

const auth = firebase.auth();
const db = firebase.firestore();

function login() {
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;

  if (!email.endsWith('@supplylogic.com')) {
    alert('Only @supplylogic.com emails allowed');
    return;
  }

  auth.signInWithEmailAndPassword(email, password)
    .catch(err => alert(err.message));
}

function logout() {
  auth.signOut();
}

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    document.getElementById('appHeader').style.display = 'flex';
    document.getElementById('userEmail').textContent = user.email;

    if (user.email.startsWith('admin')) {
      document.getElementById('adminPanel').classList.remove('hidden');
    }

    loadLogs();
  } else {
    document.getElementById('loginPage').classList.remove('hidden');
    document.getElementById('app').classList.add('hidden');
    document.getElementById('appHeader').style.display = 'none';
  }
});

const companies = {
  'Shopify': ['Bayada Wear','First Watch Shop','First Watch Swag','KOC','Learfield','Raising Cane\'s Gear','Sevita','The Home Homer','Dave & Buster\'s','Premise Health'],
  'Marcom': ['American Airlines Credit Union','Applebee\'s','Brinker','Cash America','Choice Hotels','Dave & Buster\'s / Main Event','Denny\'s','Fogo de Chao','IHOP','Noodles & Company','Pei Wei','Pizza Hut','Steak N Shake'],
  'Marketing Bench': ['Aaron\'s, Inc.','AdventHealth','Baltimore Ravens','Under Armour','Wyndham Hotels & Resorts']
};

function loadCompanies() {
  const sel = document.getElementById('company');
  sel.innerHTML = '';
  (companies[tool.value] || []).forEach(c => {
    const o = document.createElement('option');
    o.textContent = c;
    sel.appendChild(o);
  });
}

function saveLog() {
  db.collection('logs').add({
    customer: customer.value,
    phone: phone.value,
    ref: refId.value,
    tool: tool.value,
    company: company.value,
    disposition: disposition.value,
    status: status.value,
    notes: notes.value,
    agent: auth.currentUser.email,
    created: firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    customer.value = phone.value = refId.value = notes.value = '';
    loadLogs();
  }).catch(e => alert(e.message));
}

function loadLogs() {
  logTable.innerHTML = '';
  db.collection('logs').orderBy('created','desc').get().then(snap => {
    snap.forEach(doc => {
      const l = doc.data();
      logTable.innerHTML += `<tr>
        <td>${l.customer||''}</td>
        <td>${l.phone||''}</td>
        <td>${l.company||''}</td>
        <td>${l.disposition||''}</td>
        <td>${l.status||''}</td>
        <td>${l.agent||''}</td>
        <td>${l.created?.toDate().toLocaleString()||''}</td>
        <td><button onclick="alert(${JSON.stringify(l.notes)})">View</button></td>
      </tr>`;
    });
  });
}

function exportCSV() {
  alert('CSV export placeholder – data is in Firestore logs collection');
}
</script>

</body>
</html>
