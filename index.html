<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Supply Logic Call Logs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#f1f5f9;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#64748b;
  --accent:#2563eb;
}
body.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#38bdf8;
}
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 20px;
  background:var(--card);
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}
header img{height:95px}
.header-right{
  display:flex;
  gap:12px;
  align-items:center;
}
button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:var(--accent);
  color:white;
}
button.secondary{
  background:#64748b;
}
.container{
  max-width:1300px;
  margin:20px auto;
  padding:0 16px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  margin-bottom:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}
label{font-size:13px;color:var(--muted)}
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #cbd5f5;
  margin-top:4px;
}
textarea{min-height:120px}
.hidden{display:none}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e2e8f0;
  font-size:14px;
}
th{text-align:left;color:var(--muted)}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-content{
  background:var(--card);
  padding:20px;
  max-width:600px;
  width:90%;
  border-radius:12px;
}
</style>
</head>

<body>

<header class="hidden" id="appHeader">
  <img src="./images/SL-Logo4.png">
  <div class="header-right">
    <span id="userEmail"></span>
    <button onclick="toggleDark()">ðŸŒ™</button>
    <button class="secondary" onclick="logout()">Logout</button>
  </div>
</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginCard">
  <h2>Login</h2>
  <div class="grid">
    <div>
      <label>Email</label>
      <input id="loginEmail" placeholder="name@supplylogic.com">
    </div>
    <div>
      <label>Password (Admin only)</label>
      <input id="loginPassword" type="password">
    </div>
  </div>
  <br>
  <button onclick="login()">Login</button>
</div>

<!-- AGENT -->
<div id="agentUI" class="hidden">

<div class="card">
<h2>Call Log Entry</h2>
<form id="logForm">
<div class="grid">
  <div><label>Customer Name</label><input id="customer" required></div>
  <div><label>Phone #</label><input id="phone"></div>
  <div><label>User ID / Order # / INV #</label><input id="ref"></div>

  <div>
    <label>Tool</label>
    <select id="tool" onchange="loadCompanies()" required>
      <option>Shopify</option>
      <option>Marcom</option>
      <option>Marketing Bench</option>
    </select>
  </div>

  <div>
    <label>Company</label>
    <select id="company" required></select>
  </div>

  <div>
    <label>Disposition</label>
    <select id="disposition">
      <option>Password Reset</option>
      <option>Order Entry</option>
      <option>Order Status / Tracking</option>
      <option>Impersonate</option>
    </select>
  </div>

  <div>
    <label>Status</label>
    <select id="status">
      <option>Open</option>
      <option>Follow-up</option>
      <option>Resolved</option>
    </select>
  </div>
</div>

<br>
<label>Notes</label>
<textarea id="notes">
<strong>Concern:</strong>

<strong>Action Taken:</strong>
</textarea>

<br><br>
<button type="submit">Save Log</button>
</form>
</div>

<div class="card">
<h2>History</h2>
<input id="searchCompany" placeholder="Filter by company">
<input type="date" id="searchDate">
<table>
<thead>
<tr>
<th>Customer</th><th>Phone</th><th>Disposition</th><th>Company</th>
<th>Status</th><th>Notes</th><th>Date</th><th>Agent</th>
</tr>
</thead>
<tbody id="logs"></tbody>
</table>
</div>
</div>

<!-- ADMIN -->
<div id="adminUI" class="hidden">
<div class="card">
<h2>Admin Analytics</h2>
<div id="analytics"></div>
<button onclick="exportCSV()">Export CSV</button>
</div>
</div>

</div>

<!-- NOTES MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div id="modalText"></div><br>
    <button onclick="closeModal()">Close</button>
  </div>
</div>

<script>
/* ðŸ”¥ FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyBEbq_d9nGXFLNdHaWICDfOzvQECC6yjOQ",
  authDomain: "call-logs-tool.firebaseapp.com",
  projectId: "call-logs-tool"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* DARK MODE */
function toggleDark(){
  document.body.classList.toggle("dark");
}

/* LOGIN */
function login(){
  const email = loginEmail.value;
  const pass = loginPassword.value;
  if(!email.endsWith("@supplylogic.com")) return alert("Access restricted");

  if(pass){
    auth.signInWithEmailAndPassword(email, pass);
  }else{
    auth.signInWithEmailAndPassword(email, "agent-temp-pass");
  }
}

/* AUTH STATE */
auth.onAuthStateChanged(user=>{
  if(!user) return;
  loginCard.classList.add("hidden");
  appHeader.classList.remove("hidden");
  userEmail.textContent = user.email;

  if(user.email.includes("admin")){
    adminUI.classList.remove("hidden");
    loadAnalytics();
  }else{
    agentUI.classList.remove("hidden");
    loadLogs();
  }
});

/* LOGOUT */
function logout(){
  auth.signOut();
  location.reload();
}

/* COMPANIES */
const companies={ /* trimmed for brevity in explanation, full list kept */
  "Shopify":[
    "Bayada Wear","First Watch Shop","First Watch Swag","KOC","Learfield",
    "Raising Cane's Gear","Sevita","The Home Homer","Dave & Busterâ€™s","Premise Health"
  ],
  "Marcom":[
    "American Airlines Credit Union","Applebee's","Brinker","Cash America",
    "Choice Hotels","Dave & Buster's / Main Event","Denny's","Fogo de Chao","IHOP",
    "Noodles & Company","Pei Wei","Pizza Hut","Zaxby's"
  ],
  "Marketing Bench":[
    "23 Restaurant Services","Aaron's, Inc.","AdventHealth","Baltimore Ravens",
    "Under Armour","Wyndham Hotels&Resorts, Inc.","Yokohama Off Highway Tires"
  ]
};

function loadCompanies(){
  company.innerHTML="";
  companies[tool.value].forEach(c=>{
    const o=document.createElement("option");
    o.textContent=c;
    company.appendChild(o);
  });
}
loadCompanies();

/* SAVE LOG */
logForm.addEventListener("submit",e=>{
  e.preventDefault();
  db.collection("logs").add({
    customer:customer.value,
    phone:phone.value,
    ref:ref.value,
    tool:tool.value,
    company:company.value,
    disposition:disposition.value,
    status:status.value,
    notes:notes.value,
    agent:auth.currentUser.email,
    date:new Date()
  });
  logForm.reset();
  loadCompanies();
});

/* LOAD LOGS */
function loadLogs(){
  db.collection("logs").orderBy("date","desc")
  .onSnapshot(snap=>{
    logs.innerHTML="";
    snap.forEach(d=>{
      const l=d.data();
      logs.innerHTML+=`
      <tr>
        <td>${l.customer}</td>
        <td>${l.phone}</td>
        <td>${l.disposition}</td>
        <td>${l.company}</td>
        <td>${l.status}</td>
        <td><button onclick="viewNotes(\`${l.notes}\`)">View</button></td>
        <td>${l.date.toDate().toLocaleString()}</td>
        <td>${l.agent}</td>
      </tr>`;
    });
  });
}

/* NOTES MODAL */
function viewNotes(t){
  modal.style.display="flex";
  modalText.innerHTML=t;
}
function closeModal(){modal.style.display="none"}

/* ADMIN ANALYTICS */
function loadAnalytics(){
  db.collection("logs").get().then(s=>{
    analytics.innerHTML=`Total Logs: ${s.size}`;
  });
}

/* CSV */
function exportCSV(){
  db.collection("logs").get().then(s=>{
    let csv="Customer,Phone,Company,Disposition,Status,Agent,Date\n";
    s.forEach(d=>{
      const l=d.data();
      csv+=`${l.customer},${l.phone},${l.company},${l.disposition},${l.status},${l.agent},${l.date.toDate()}\n`;
    });
    const a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([csv]));
    a.download="call_logs.csv";
    a.click();
  });
}
</script>
</body>
</html>
