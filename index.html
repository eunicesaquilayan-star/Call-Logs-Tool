<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Call Logs Tool</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--bg:#f4f6f9;--card:#fff;--text:#212529;--border:#dee2e6;--primary:#0d6efd}
body.dark{--bg:#121212;--card:#1e1e1e;--text:#e9ecef;--border:#2a2a2a}
body{font-family:Arial;background:var(--bg);color:var(--text);margin:0}
.container{max-width:1600px;margin:30px auto;background:var(--card);padding:30px;border-radius:12px}
header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid var(--border);padding-bottom:15px}
button{background:var(--primary);color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer}
input,select,textarea{width:100%;padding:10px;margin-bottom:12px;border-radius:6px;border:1px solid var(--border)}
textarea{min-height:200px}
.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid var(--border);padding:10px}
.agent-badge{position:fixed;top:15px;right:20px;background:var(--primary);color:white;padding:8px 14px;border-radius:20px}
</style>
</head>

<body>

<div id="agentBadge" class="agent-badge hidden"></div>

<div class="container">

<header>
 <img src="./images/SL-Logo4.png" height="95">
 <div>
  <button onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
  <button id="logoutBtn" class="hidden" onclick="logout()">Logout</button>
 </div>
</header>

<!-- LOGIN -->
<div id="loginSection">
 <h3>Login</h3>
 <input id="email" placeholder="Email">
 <input id="password" type="password" placeholder="Admin Password">
 <button onclick="login()">Login</button>
</div>

<!-- AGENT -->
<div id="agentSection" class="hidden">

<h3>New Call Log</h3>

<select id="tool" onchange="loadCompanies()">
 <option value="">Select Tool *</option>
 <option value="Shopify">Shopify</option>
 <option value="Marcom">Marcom</option>
 <option value="Marketing Bench">Marketing Bench</option>
</select>

<select id="company" disabled>
 <option value="">Select Company *</option>
</select>

<input id="ref" placeholder="User ID / Order # / Inv #">

<select id="disposition">
 <option value="">Disposition *</option>
 <option>Password Reset</option>
 <option>Order Entry</option>
 <option>Order Status</option>
 <option>General Inquiry</option>
</select>

<select id="status">
 <option>Open</option>
 <option>Follow Up</option>
 <option>Resolved</option>
</select>

<textarea id="notes">CONCERN:

ACTION TAKEN:</textarea>

<button onclick="submitLog()">Submit Log</button>
</div>

</div>

<script>
/* FIREBASE */
firebase.initializeApp({
 apiKey:"AIzaSyBEbq_d9nGXFLNdHaWICDfOzvQECC6yjOQ",
 authDomain:"call-logs-tool.firebaseapp.com",
 projectId:"call-logs-tool"
});
const db=firebase.firestore();

/* TOOL ‚Üí COMPANY (STRICT MATCH) */
const companyMap={
 "Shopify":[
  "Bayada Wear",
  "First Watch Shop",
  "First Watch Swag"
 ],
 "Marcom":[
  "Cash America",
  "Choice Hotels",
  "Dave & Buster's / Main Event"
 ],
 "Marketing Bench":[
  "23 Restaurant Services",
  "Aaron's, Inc.",
  "Access Marketing Services"
 ]
};

let user="",startTime=0;

/* LOGIN */
function login(){
 user=email.value.trim();
 if(!user) return alert("Email required");

 if(password.value && password.value!=="rperez@123")
  return alert("Wrong admin password");

 startTime=Date.now();
 loginSection.classList.add("hidden");
 logoutBtn.classList.remove("hidden");
 agentBadge.textContent=user;
 agentBadge.classList.remove("hidden");
 agentSection.classList.remove("hidden");
}

/* TOOL ‚Üí COMPANY (FIXED) */
function loadCompanies(){
 const toolValue = tool.value;

 company.innerHTML = '<option value="">Select Company *</option>';
 company.disabled = true;

 if(!companyMap[toolValue]) return;

 companyMap[toolValue].forEach(name=>{
  const opt=document.createElement("option");
  opt.value=name;
  opt.textContent=name;
  company.appendChild(opt);
 });

 company.disabled = false;
}

/* SUBMIT */
async function submitLog(){
 if(!tool.value||!company.value||!disposition.value)
  return alert("Complete required fields");

 const mins=((Date.now()-startTime)/60000).toFixed(2);

 await db.collection("logs").add({
  agent:user,
  tool:tool.value,
  company:company.value,
  ref:ref.value,
  disposition:disposition.value,
  status:status.value,
  notes:notes.value,
  minutes:+mins,
  date:new Date().toISOString().split("T")[0]
 });

 alert("Log saved");
 location.reload();
}

/* UI */
function toggleTheme(){document.body.classList.toggle("dark")}
function logout(){location.reload()}
</script>

</body>
</html>
