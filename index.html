<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Call Logs Tool</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
:root{
 --bg:#f4f6f9;--card:#fff;--text:#212529;--border:#dee2e6;--primary:#0d6efd
}
body.dark{
 --bg:#121212;--card:#1e1e1e;--text:#e9ecef;--border:#2a2a2a
}
body{font-family:Arial;background:var(--bg);color:var(--text);margin:0}
.container{max-width:1600px;margin:30px auto;background:var(--card);padding:30px;border-radius:12px}
header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid var(--border);padding-bottom:15px}
button{background:var(--primary);color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer}
input,select,textarea{width:100%;padding:10px;margin-bottom:12px;border-radius:6px;border:1px solid var(--border)}
textarea{min-height:220px}
.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid var(--border);padding:10px}
.note-box{white-space:pre-wrap}
</style>
</head>

<body>

<div class="container">

<header>
 <img src="./images/SL-Logo4.png" height="95">
 <div>
  <button onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
  <button id="logoutBtn" class="hidden" onclick="logout()">Logout</button>
 </div>
</header>

<!-- LOGIN -->
<div id="loginSection">
 <h3>Login</h3>
 <input id="email" placeholder="Email">
 <input id="password" type="password" placeholder="Admin Password (admins only)">
 <button onclick="login()">Login</button>
</div>

<!-- AGENT -->
<div id="agentSection" class="hidden">

<h3>New Call Log</h3>

<select id="tool" onchange="loadCompanies()">
 <option value="">Select Tool *</option>
 <option value="Shopify">Shopify</option>
 <option value="Marcom">Marcom</option>
 <option value="Marketing Bench">Marketing Bench</option>
</select>

<select id="company" disabled>
 <option value="">Select Company *</option>
</select>

<input id="name" placeholder="Customer Name">
<input id="phone" placeholder="Phone">
<input id="ref" placeholder="User ID / Order # / Inv #">

<select id="disposition">
 <option value="">Disposition *</option>
 <option>Password Reset</option>
 <option>Order Entry</option>
 <option>Order Status</option>
 <option>General Inquiry</option>
</select>

<select id="status">
 <option value="Open">Open</option>
 <option value="Follow Up">Follow Up</option>
 <option value="Resolved">Resolved</option>
</select>

<textarea id="notes">CONCERN:

ACTION TAKEN:</textarea>

<button onclick="submitLog()">Submit Log</button>

<table>
<thead>
<tr>
<th>Agent</th><th>Company</th><th>Disposition</th><th>Status</th><th>Notes</th><th>Date</th>
</tr>
</thead>
<tbody id="agentLogs"></tbody>
</table>

</div>

<script>
/* FIREBASE */
/* üî• FIREBASE INIT */
 /* DOM ELEMENTS */
const loginSection = document.getElementById("loginSection");
const agentSection = document.getElementById("agentSection");
const logoutBtn = document.getElementById("logoutBtn");

const tool = document.getElementById("tool");
const company = document.getElementById("company");
const disposition = document.getElementById("disposition");
const status = document.getElementById("status");
const refInput = document.getElementById("ref");
const notes = document.getElementById("notes");
const agentLogs = document.getElementById("agentLogs");

firebase.initializeApp({
  apiKey: "AIzaSyBEbq_d9nGXFLNdHaWICDfOzvQECC6yjOQ",
  authDomain: "call-logs-tool.firebaseapp.com",
  projectId: "call-logs-tool"
});

const db = firebase.firestore();
const auth = firebase.auth();
 let authReady = false;

auth.onAuthStateChanged(user => {
  if (user) {
    authReady = true;
    console.log("üîê Authenticated as:", user.uid);
  }
});


/* üîê REQUIRED FOR GITHUB PAGES */
auth.signInAnonymously()
 .then(()=>console.log("‚úÖ Anonymous Auth Ready"))
 .catch(err=>console.error("‚ùå Auth Error", err));

/* STATE */
let user = sessionStorage.getItem("user") || "";
let startTime = Date.now();

/* THEME */
function toggleTheme(){
 document.body.classList.toggle("dark");
}

/* LOGIN */
function login(){
if (!authReady) {
  alert("Auth still initializing. Please wait a moment.");
  return;
}

 const u = document.getElementById("email").value.trim();
 if(!u) return alert("Email required");

 user = u;
 sessionStorage.setItem("user", user);
 startTime = Date.now();

 loginSection.classList.add("hidden");
 agentSection.classList.remove("hidden");
 logoutBtn.classList.remove("hidden");

 loadAgentLogs();
}

/* LOGOUT */
function logout(){
 sessionStorage.clear();
 location.reload();
}

/* AUTO RESTORE SESSION */
if(user){
 loginSection.classList.add("hidden");
 agentSection.classList.remove("hidden");
 logoutBtn.classList.remove("hidden");
 loadAgentLogs();
}

/* TOOL ‚Üí COMPANY */
const companyMap = {
 Shopify:["Bayada Wear","First Watch Shop","First Watch Swag"],
 Marcom:["Cash America","Choice Hotels","Dave & Buster's / Main Event"],
 "Marketing Bench":["23 Restaurant Services","Aaron's, Inc.","Access Marketing Services"]
};

function loadCompanies(){
 company.innerHTML='<option value="">Select Company *</option>';
 company.disabled=true;
 (companyMap[tool.value] || []).forEach(c=>{
  const o=document.createElement("option");
  o.value=c;
  o.textContent=c;
  company.appendChild(o);
 });
 company.disabled=false;
}

/* SUBMIT LOG */
async function submitLog(){

  if (!authReady) {
    alert("Auth not ready yet. Please wait 1‚Äì2 seconds and try again.");
    return;
  }

  if(!tool.value || !company.value || !disposition.value){
    alert("Please complete required fields");
    return;
  }

  try {
    const minutes = ((Date.now() - startTime) / 60000).toFixed(2);

    await db.collection("logs").add({
      agent: user,
      tool: tool.value,
      company: company.value,
      disposition: disposition.value,
      status: status.value,
      ref: refInput.value || "",
      notes: notes.value || "",
      minutes: Number(minutes),
      date: new Date().toISOString().split("T")[0],
      created: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("‚úÖ Log saved successfully");
    startTime = Date.now();
    refInput.value = "";

  } catch (err) {
    console.error("üî• Firestore write failed:", err);
    alert("‚ùå Failed to save log. Check console.");
  }
}

/* ENTER TO SUBMIT */
document.addEventListener("keydown", e => {

  // ENTER = login
  if (e.key === "Enter" && !loginSection.classList.contains("hidden")) {
    login();
  }

  // CTRL + ENTER = submit log
  if (e.key === "Enter" && e.ctrlKey && !agentSection.classList.contains("hidden")) {
    submitLog();
  }

});

/* LOAD AGENT LOGS */
function loadAgentLogs(){
 db.collection("logs")
 .where("agent","==",user)
 .orderBy("date")
 .onSnapshot(snap=>{
  agentLogs.innerHTML="";
  snap.forEach(doc=>{
   const d = doc.data();
   agentLogs.innerHTML += `
    <tr>
     <td>${d.agent}</td>
     <td>${d.company}</td>
     <td>${d.disposition}</td>
     <td>${d.status}</td>
     <td class="note-box">${d.notes}</td>
     <td>${d.date}</td>
    </tr>`;
  });
 }, err=>{
  console.error("Snapshot error:", err);
 });
}
</script>


</body>
</html>


